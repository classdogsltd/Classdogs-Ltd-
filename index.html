<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLASS DOGS LTD - Premier Dog Breeds in Kenya</title>
    <meta name="keywords" content="golden retrievers in kenya, pets in kenya, puppies for sale in kenya, dog breeds Nairobi, dog breeds Mombasa, reputable dog breeder kenya, class dogs ltd">
    <meta name="description" content="Find the best purebred puppies and dogs for sale in Kenya, featuring popular breeds like Golden Retrievers, German Shepherds, and more, serving Nairobi, Mombasa, Kisumu, and Eldoret.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900;1,300..1,700;1,400..1,700;1,300..1,900&family=Roboto+Slab:wght@100..900;1,100..900;1,300..1,700;1,400..1,700;1,300..1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900;1,300..1,700;1,400..1,700;1,300..1,900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Oswald:wght@200..700&family=Poiret+One&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

    <style>
        /* Base styles using Inter font (Tailwind default) */
        :root {
            --primary-color: #A34A00; /* Rich Brown/Orange */
            --secondary-color: #2D3748; /* Dark Grey */
            --accent-color: #F6AD55; /* Light Orange */
            --bg-color: #F7FAFC; /* Light Grey background */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--secondary-color);
            transition: font-family 0.5s ease;
        }
        /* Custom Fonts for Admin Selection */
        .font-playfair { font-family: 'Playfair Display', serif; }
        .font-robotoslab { font-family: 'Roboto Slab', serif; }
        .font-lato { font-family: 'Lato', sans-serif; }
        .font-montserrat { font-family: 'Montserrat', sans-serif; }
        .font-opensans { font-family: 'Open Sans', sans-serif; }
        .font-merriweather { font-family: 'Merriweather', serif; }
        .font-oswald { font-family: 'Oswald', sans-serif; }
        .font-poiretone { font-family: 'Poiret One', cursive; }
        .font-cormorant { font-family: 'Cormorant Garamond', serif; }
        .font-inter { font-family: 'Inter', sans-serif; }

        /* Custom Animations */
        .slide-in-right {
            animation: slideInRight 0.5s ease-out;
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Vertical Slideshow for Vet Care */
        .vet-slider-container {
            height: 400px;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .vet-slide {
            height: 100%;
            scroll-snap-align: start;
            flex-shrink: 0;
            opacity: 0.8;
            transition: opacity 0.5s ease;
            background-size: cover; /* Ensure full coverage */
            background-position: center;
        }
        .vet-slide:hover {
            opacity: 1;
        }
        .vet-slide img {
            object-fit: cover;
        }
        .slide-nav-dot {
            transition: background-color 0.3s, transform 0.3s;
        }
    </style>
</head>
<body class="min-h-screen">

    <div id="app-container" class="max-w-7xl mx-auto">
        <header class="sticky top-0 z-50 bg-white shadow-md p-4 flex justify-between items-center rounded-b-xl">
            <h1 class="text-2xl font-bold" style="color: var(--primary-color);">CLASS DOGS LTD</h1>
            <nav class="flex space-x-4">
                <button onclick="window.navigate('home')" class="nav-btn text-gray-700 hover:text-orange-600 font-medium transition duration-200">Home</button>
                <button onclick="window.navigate('breeds')" class="nav-btn text-gray-700 hover:text-orange-600 font-medium transition duration-200">Breeds</button>
                <button onclick="window.navigate('admin')" class="nav-btn text-gray-700 hover:text-orange-600 font-medium transition duration-200">Admin</button>
            </nav>
        </header>

        <main id="main-content" class="p-4 sm:p-6 md:p-8">
            </main>

        <footer class="bg-gray-800 text-white p-6 mt-12 rounded-t-xl">
            <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h3 class="font-bold text-lg mb-2 text-orange-400">Our Location</h3>
                    <p class="mb-2">CLASS DOGS LTD</p>
                    <a href="https://maps.app.goo.gl/YourGoogleMapsLink" target="_blank" class="text-blue-300 hover:text-blue-100 flex items-center transition duration-200">
                        <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                        View on Google Maps
                    </a>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-2 text-orange-400">Contact Us</h3>
                    <a href="tel:+254713844025" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full shadow-lg flex items-center justify-center transition duration-300 transform hover:scale-105 w-full md:w-auto">
                        <i data-lucide="phone" class="w-5 h-5 mr-2"></i>
                        Call Now: +254 713 844025
                    </a>
                </div>
                <div class="text-right flex flex-col justify-end items-end">
                    <p class="text-sm">Â© 2025 CLASS DOGS LTD. All rights reserved.</p>
                </div>
            </div>
        </footer>

        <div id="custom-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-[100] hidden justify-center items-center p-4">
            <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
                <h3 id="modal-title" class="text-xl font-bold mb-4 text-gray-800"></h3>
                <p id="modal-body" class="mb-6 text-gray-600"></p>
                <div id="modal-actions" class="flex justify-end space-x-3">
                    <button onclick="window.closeModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-200">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, addDoc, updateDoc, deleteDoc, arrayUnion, arrayRemove, serverTimestamp, increment, runTransaction } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set Firebase Log Level to Debug
        setLogLevel('Debug');
        
        // --- IMPORTANT: Expose imported functions globally to resolve ReferenceErrors in window-attached functions ---
        window.doc = doc;
        window.collection = collection;
        window.runTransaction = runTransaction;
        window.setDoc = setDoc;
        window.onSnapshot = onSnapshot;
        window.addDoc = addDoc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.arrayUnion = arrayUnion;
        window.arrayRemove = arrayRemove;
        window.serverTimestamp = serverTimestamp;
        window.increment = increment;
        // ---------------------------------------------------------------------------------------------------

        // Global Firebase Variables
        window.firebaseApp = null;
        window.db = null;
        window.auth = null;
        window.userId = null;
        window.isAuthReady = false;
        window.breeds = []; // Global state for dog breeds
        window.vetSlides = []; // NEW: Global state for vet slides (Req 3)
        window.isAdminAuthenticated = false; // Admin state

        // Configuration and App ID
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-dog-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        // Data Path Constants
        const PUBLIC_DATA_PATH = (collectionName) => `artifacts/${appId}/public/data/${collectionName}`;
        const BREED_COLLECTION = PUBLIC_DATA_PATH('dogBreeds');
        const STATS_COLLECTION = PUBLIC_DATA_PATH('siteStats');
        const VET_SLIDES_COLLECTION = PUBLIC_DATA_PATH('vetSlides'); // NEW

        // --- COMPREHENSIVE DOG BREED LIST (User Request 1) ---
        const ALL_DOG_BREEDS = [
            'Affenpinscher', 'Afghan Hound', 'Airedale Terrier', 'Akita', 'Alaskan Malamute', 'American Bulldog', 'American Eskimo Dog', 'American Staffordshire Terrier',
            'Australian Cattle Dog', 'Australian Shepherd', 'Basenji', 'Basset Hound', 'Beagle', 'Bearded Collie', 'Belgian Malinois', 'Bernese Mountain Dog', 'Bichon Frise', 
            'Bloodhound', 'Border Collie', 'Border Terrier', 'Boston Terrier', 'Boxer', 'Bulldog', 'Bull Terrier', 'Cairn Terrier', 'Cane Corso', 'Chihuahua', 
            'Chow Chow', 'Cocker Spaniel', 'Collie', 'Dachshund', 'Dalmatian', 'Doberman Pinscher', 'English Cocker Spaniel', 'English Setter', 'English Springer Spaniel', 
            'French Bulldog', 'German Shepherd Dog', 'German Shorthaired Pointer', 'Giant Schnauzer', 'Golden Retriever', 'Great Dane', 'Great Pyrenees', 'Greyhound', 
            'Havanese', 'Irish Setter', 'Irish Wolfhound', 'Jack Russell Terrier', 'Japanese Chin', 'Keeshond', 'Labrador Retriever', 'Lhasa Apso', 'Maltese', 
            'Miniature Pinscher', 'Miniature Schnauzer', 'Newfoundland', 'Norwegian Elkhound', 'Old English Sheepdog', 'Papillon', 'Pekingese', 'Pembroke Welsh Corgi', 
            'Pomeranian', 'Poodle (Miniature)', 'Poodle (Standard)', 'Pug', 'Rhodesian Ridgeback', 'Rottweiler', 'Saint Bernard', 'Samoyed', 'Shetland Sheepdog', 
            'Shiba Inu', 'Shih Tzu', 'Siberian Husky', 'Staffordshire Bull Terrier', 'Vizsla', 'Weimaraner', 'Whippet', 'Yorkshire Terrier', 
            'Mutt/Mixed Breed' // Added as an option
        ].sort();

        // Initial Sample Data (if database is empty) - Updated with new fields (User Request 3)
        const initialBreeds = [
            {
                id: 'golden', breed: 'Golden Retriever', description: 'A beloved family companion, known for its intelligence and loyalty. Excellent with children. They have a friendly demeanor and a golden coat, making them highly popular.', price: 150000, isNegotiable: true,
                images: [
                    "https://placehold.co/800x600/F6AD55/000?text=Golden+Retriever+1",
                    "https://placehold.co/800x600/F6AD55/000?text=Golden+Retriever+2",
                    "https://placehold.co/800x600/F6AD55/000?text=Golden+Retriever+3",
                    "https://placehold.co/800x600/F6AD55/000?text=Golden+Retriever+4"
                ],
                seoKeywords: 'Golden Retriever Kenya, Golden Retriever Nairobi, Puppies for sale Nairobi',
                age: '12 Weeks', // NEW
                gender: 'Female', // NEW
                purity: 'Purebred' // NEW
            },
            {
                id: 'gsd', breed: 'German Shepherd', description: 'Intelligent, courageous, and highly versatile. Often used in police and military roles. German Shepherds are loyal guardians known for their strong work ethic and protective nature.', price: 180000, isNegotiable: false,
                images: [
                    "https://placehold.co/800x600/2D3748/FFF?text=German+Shepherd+1",
                    "https://placehold.co/800x600/2D3748/FFF?text=German+Shepherd+2",
                    "https://placehold.co/800x600/2D3748/FFF?text=German+Shepherd+3",
                    "https://placehold.co/800x600/2D3748/FFF?text=German+Shepherd+4"
                ],
                seoKeywords: 'German Shepherd Kenya, GSD for sale Mombasa, Protection dogs Kenya',
                age: '1 year', // NEW
                gender: 'Male', // NEW
                purity: 'Purebred' // NEW
            }
        ];
        
        // Initial Sample Data for Vet Slides (Req 3)
        const initialVetSlides = [
            { id: 'v1', url: "https://placehold.co/800x400/81E6D9/000?text=Vaccination+Day", alt: "Dog receiving vaccination from vet" },
            { id: 'v2', url: "https://placehold.co/800x400/63B3ED/000?text=Wellness+Checkup", alt: "Veterinarian checking a puppy's heart" },
            { id: 'v3', url: "https://placehold.co/800x400/9F7AEA/000?text=Post-Op+Care", alt: "Vet comforting a large dog" },
            { id: 'v4', url: "https://placehold.co/800x400/48BB78/000?text=Dental+Health", alt: "Puppy getting teeth checked by vet" }
        ];

        // --- GLOBAL UI UTILITIES ---

        window.showModal = function showModal(title, body, type = 'info', actions = []) {
            const modal = document.getElementById('custom-modal');
            const modalContent = document.getElementById('modal-content');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = body;

            const actionsDiv = document.getElementById('modal-actions');
            actionsDiv.innerHTML = `<button onclick="window.closeModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-200">Close</button>`;

            actions.forEach(action => {
                const btn = document.createElement('button');
                btn.className = action.class || 'px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition duration-200 ml-3';
                btn.textContent = action.text;
                btn.onclick = () => { action.handler(); };
                actionsDiv.prepend(btn);
            });

            if (type === 'error') {
                document.getElementById('modal-title').classList.add('text-red-600');
            } else {
                document.getElementById('modal-title').classList.remove('text-red-600');
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            lucide.createIcons();

            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        window.closeModal = function closeModal() {
            const modal = document.getElementById('custom-modal');
            const modalContent = document.getElementById('modal-content');

            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 300);
        }


        // --- FIREBASE INITIALIZATION AND AUTHENTICATION (Req 5: Improved robustness) ---
        window.initializeAppAndAuth = async () => {
            try {
                if (window.firebaseApp) return;

                if (!firebaseConfig.apiKey || !firebaseConfig.projectId) {
                    throw new Error("Missing required Firebase configuration (apiKey or projectId). Ensure __firebase_config is correctly provided.");
                }

                window.firebaseApp = initializeApp(firebaseConfig);
                window.db = getFirestore(window.firebaseApp);
                window.auth = getAuth(window.firebaseApp);

                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                let authInitialized = false; 

                onAuthStateChanged(window.auth, async (user) => {
                    if (!authInitialized) {
                        authInitialized = true;
                        
                        if (user) {
                            window.userId = user.uid;
                        } else {
                            if (initialAuthToken) {
                                try {
                                    await signInWithCustomToken(window.auth, initialAuthToken);
                                    window.userId = window.auth.currentUser.uid;
                                } catch (e) {
                                    console.error("Custom token failed, falling back to anonymous.", e);
                                    await signInAnonymously(window.auth);
                                    window.userId = window.auth.currentUser?.uid || crypto.randomUUID();
                                }
                            } else {
                                await signInAnonymously(window.auth);
                                window.userId = window.auth.currentUser?.uid || crypto.randomUUID();
                            }
                        }

                        window.isAuthReady = true;
                        startListeners();
                        trackVisitor();
                        const initialView = window.location.hash.replace('#', '') || 'home';
                        window.navigate(initialView);
                    } else if (user) {
                        window.userId = user.uid;
                    }
                });

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
                window.showModal('Initialization Error', `Failed to initialize application. Check console. If running on GitHub, ensure environment variables (like '__firebase_config') are correctly injected by the hosting service.`, 'error');
            }
        };

        // --- FIRESTORE LISTENERS ---
        function startListeners() {
            if (!window.isAuthReady || !window.db) return;

            // 1. Dog Breeds Listener
            window.onSnapshot(window.collection(window.db, BREED_COLLECTION), (snapshot) => {
                const docCount = snapshot.size;

                if (docCount === 0) {
                    console.log("No breeds found. Initializing sample data...");
                    initialBreeds.forEach(breed => {
                        const docRef = window.doc(window.db, BREED_COLLECTION, breed.id);
                        window.setDoc(docRef, breed, { merge: true }).catch(err => console.error("Error setting initial breed data:", err));
                    });
                } else {
                    window.breeds = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    
                    // Re-render only if needed
                    const hash = window.location.hash.replace('#', '');
                    if (hash === 'breeds') {
                        renderBreedsPage();
                    } else if (hash.startsWith('details/')) {
                         // Force re-render details if data changed
                        window.navigate(hash);
                    } else if (hash === 'admin' && window.isAdminAuthenticated) {
                        renderBreedListInAdmin();
                        // Renamed function call
                        renderBreedDetailEditorList();
                    }
                }
            }, (error) => {
                console.error("Error listening to dog breeds:", error);
                window.showModal('Data Error', 'Failed to load dog breed data.', 'error');
            });

            // 2. Vet Slides Listener (Req 3)
            window.onSnapshot(window.collection(window.db, VET_SLIDES_COLLECTION), (snapshot) => {
                const docCount = snapshot.size;

                if (docCount === 0) {
                    console.log("No vet slides found. Initializing sample data...");
                    initialVetSlides.forEach(slide => {
                        const docRef = window.doc(window.db, VET_SLIDES_COLLECTION, slide.id);
                        window.setDoc(docRef, slide, { merge: true }).catch(err => console.error("Error setting initial slide data:", err));
                    });
                } else {
                    window.vetSlides = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    
                    if (window.location.hash === '#home') {
                        // Re-render home page to update the slideshow
                        document.getElementById('main-content').innerHTML = renderHomePage();
                        startVetSlideshow();
                    }
                    if (window.location.hash === '#admin' && document.getElementById('vet-slide-list')) {
                        // Only re-render the admin section if the element exists
                        document.getElementById('vet-slide-list').innerHTML = renderVetSlidesList();
                        lucide.createIcons();
                    }
                }
            }, (error) => {
                console.error("Error listening to vet slides:", error);
            });

            // 3. Site Stats Listener
            window.onSnapshot(window.collection(window.db, STATS_COLLECTION), (snapshot) => {
                const stats = snapshot.docs.map(doc => doc.data());
                renderPerformanceStats(stats); // This function is safe to call here
            }, (error) => {
                console.error("Error listening to site stats:", error);
            });
        }

        // --- FIRESTORE UTILITIES ---

        async function trackVisitor() {
            if (!window.db || !window.isAuthReady) return;
            const today = new Date().toISOString().slice(0, 10);
            const docRef = window.doc(window.db, STATS_COLLECTION, today);

            try {
                // Using runTransaction to prevent race conditions and ensure atomic increment (Req 6)
                await window.runTransaction(window.db, async (transaction) => {
                    const docSnapshot = await transaction.get(docRef);
                    if (!docSnapshot.exists()) {
                        transaction.set(docRef, { count: 1, date: today, timestamp: window.serverTimestamp() });
                    } else {
                        transaction.update(docRef, { count: window.increment(1) });
                    }
                });

            } catch (e) {
                console.error("Transaction failed to track visitor:", e);
            }
        }

        // --- NAVIGATION AND VIEW RENDERING (Req 4: Updated routing for details page) ---
        window.navigate = (view) => {
            const contentDiv = document.getElementById('main-content');
            window.location.hash = view; // Update URL hash

            // Reset navigation button styles
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('bg-orange-100', 'rounded-lg', 'p-2'));

            const parts = view.split('/');
            
            contentDiv.innerHTML = ''; // Clear content for redraw
            contentDiv.classList.add('slide-in-right');

            if (parts[0] === 'details' && parts.length === 2) {
                // Breed Details Page (Req 4)
                contentDiv.innerHTML = renderBreedDetailsPage(parts[1]);
                feather.replace(); // Initialize feather icons (for WhatsApp)
            } else {
                // Standard navigation
                switch (view) {
                    case 'home':
                        document.querySelector('button[onclick="window.navigate(\'home\')"]').classList.add('bg-orange-100', 'rounded-lg', 'p-2');
                        contentDiv.innerHTML = renderHomePage();
                        startVetSlideshow();
                        break;
                    case 'breeds':
                        document.querySelector('button[onclick="window.navigate(\'breeds\')"]').classList.add('bg-orange-100', 'rounded-lg', 'p-2');
                        contentDiv.innerHTML = '<h2 class="text-3xl font-extrabold mb-8 text-center" style="color: var(--secondary-color);">Our Available Breeds</h2><div id="breeds-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>';
                        renderBreedsPage();
                        break;
                    case 'admin':
                        document.querySelector('button[onclick="window.navigate(\'admin\')"]').classList.add('bg-orange-100', 'rounded-lg', 'p-2');
                        if (window.isAdminAuthenticated) {
                            renderAdminPanel();
                        } else {
                            contentDiv.innerHTML = renderAdminAuth();
                        }
                        break;
                    default:
                        contentDiv.innerHTML = renderHomePage();
                        startVetSlideshow();
                }
            }
            lucide.createIcons();
        };

        // --- RENDER HOME PAGE ---
        function renderHomePage() {
            // Use window.vetSlides for dynamic data (Req 3)
            const slidesToRender = window.vetSlides.length > 0 ? window.vetSlides : initialVetSlides;

            return `
                <section class="bg-gray-100 rounded-3xl p-6 md:p-12 mb-12 shadow-xl border-t-8 border-orange-500 transform hover:shadow-2xl transition duration-500">
                    <div class="md:flex md:items-center">
                        <div class="md:w-1/2">
                            <h2 class="text-5xl md:text-6xl font-extrabold leading-tight mb-4 font-playfair" style="color: var(--primary-color);">
                                Your Next Best Friend is Waiting in <span class="text-orange-500">Kenya</span>
                            </h2>
                            <p class="text-xl text-gray-700 mb-6">
                                CLASS DOGS LTD connects you with healthy, purebred puppies from reputable lines across Nairobi, Mombasa, and beyond.
                            </p>
                            <button onclick="window.navigate('breeds')" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 flex items-center w-fit">
                                <i data-lucide="paw-print" class="w-5 h-5 mr-2"></i>
                                Explore Breeds
                            </button>
                        </div>
                        <div class="md:w-1/2 mt-8 md:mt-0 md:pl-10">
                            <img src="https://placehold.co/600x400/A34A00/FFF?text=Happy+Puppy+Kenya" onerror="this.onerror=null;this.src='https://via.placeholder.com/600x400/A34A00/FFF';" alt="A friendly dog running in a Kenyan field" class="rounded-2xl shadow-xl">
                        </div>
                    </div>
                </section>

                <section class="mb-12 p-6 bg-white rounded-2xl shadow-lg">
                    <h3 class="text-3xl font-bold mb-6 text-center" style="color: var(--secondary-color);">Professional Veterinary Care</h3>
                    <p class="text-center text-gray-600 mb-6">We ensure all our puppies receive the best medical attention before they join your family.</p>
                    <div class="vet-slider-container overflow-y-scroll snap-y relative rounded-xl shadow-inner">
                        <div class="flex flex-col h-full">
                            ${slidesToRender.map((slide, index) => `
                                <div class="vet-slide bg-cover bg-center relative" style="background-image: url('${slide.url}')">
                                    <div class="absolute inset-0 bg-gray-900 bg-opacity-40 flex items-center justify-center">
                                        <p class="text-white text-xl font-semibold p-4 rounded-lg bg-black bg-opacity-50">${slide.alt}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 flex flex-col space-y-2" id="vet-nav-dots">
                            ${slidesToRender.map((_, index) => `<div class="slide-nav-dot w-3 h-3 bg-gray-300 rounded-full cursor-pointer hover:bg-orange-500" data-slide="${index}"></div>`).join('')}
                        </div>
                    </div>
                </section>

                <section class="mb-12 p-6 bg-orange-50 rounded-2xl shadow-inner">
                    <h3 class="text-3xl font-bold mb-6 text-center" style="color: var(--primary-color);">Why CLASS DOGS LTD?</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                        <div class="p-4 bg-white rounded-xl shadow-md transform hover:scale-105 transition duration-300">
                            <i data-lucide="shield-check" class="w-8 h-8 mx-auto mb-3 text-green-500"></i>
                            <h4 class="font-bold text-xl mb-1">Health Guarantee</h4>
                            <p class="text-sm text-gray-600">All puppies are dewormed, vaccinated, and vet-certified.</p>
                        </div>
                        <div class="p-4 bg-white rounded-xl shadow-md transform hover:scale-105 transition duration-300">
                            <i data-lucide="plane" class="w-8 h-8 mx-auto mb-3 text-blue-500"></i>
                            <h4 class="font-bold text-xl mb-1">Nationwide Delivery</h4>
                            <p class="text-sm text-gray-600">Safe delivery available across Kenya (Nairobi, Mombasa, Kisumu, Eldoret).</p>
                        </div>
                        <div class="p-4 bg-white rounded-xl shadow-md transform hover:scale-105 transition duration-300">
                            <i data-lucide="graduation-cap" class="w-8 h-8 mx-auto mb-3 text-purple-500"></i>
                            <h4 class="font-bold text-xl mb-1">Expert Advice</h4>
                            <p class="text-sm text-gray-600">Post-purchase support and care guides from our experts.</p>
                        </div>
                    </div>
                </section>
            `;
        }

        // JS for Vertical Slideshow
        function startVetSlideshow() {
            const container = document.querySelector('.vet-slider-container');
            const dots = document.querySelectorAll('.slide-nav-dot');

            if (!container || dots.length === 0) return;

            const updateDots = () => {
                const slideHeight = container.clientHeight;
                const scrollY = container.scrollTop;
                const activeIndex = Math.round(scrollY / slideHeight);

                dots.forEach((dot, index) => {
                    if (index === activeIndex) {
                        dot.style.backgroundColor = 'var(--primary-color)';
                        dot.style.transform = 'scale(1.4)';
                    } else {
                        dot.style.backgroundColor = '#ccc';
                        dot.style.transform = 'scale(1)';
                    }
                });
            };

            container.addEventListener('scroll', updateDots);
            updateDots(); // Initial check

            dots.forEach(dot => {
                dot.addEventListener('click', () => {
                    const slideIndex = parseInt(dot.getAttribute('data-slide'));
                    container.scrollTo({ top: slideIndex * container.clientHeight, behavior: 'smooth' });
                });
            });
        }


        // --- RENDER BREEDS PAGE ---
        window.renderBreedsPage = function renderBreedsPage() {
            const container = document.getElementById('breeds-container');
            if (!container || !window.breeds || window.breeds.length === 0) {
                if (container) container.innerHTML = '<p class="text-center text-lg text-gray-500">No dog breeds currently listed. Please check back later or use the Admin panel to add some!</p>';
                return;
            }

            container.innerHTML = window.breeds.map(breed => `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden transform hover:shadow-2xl hover:scale-[1.02] transition duration-500 slide-in-right">
                    <img src="${breed.images[0] || 'https://placehold.co/600x400/A34A00/FFF?text=Image+Missing'}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/A34A00/FFF?text=Image+Missing';" alt="${breed.breed}" class="w-full h-48 object-cover">
                    <div class="p-5">
                        <h3 class="text-2xl font-bold mb-2" style="color: var(--primary-color);">${breed.breed}</h3>
                        <p class="text-gray-600 mb-4 line-clamp-3">${breed.description}</p>
                        
                        <div class="flex flex-wrap gap-2 mb-4">
                            <span class="text-xs font-medium bg-gray-100 text-gray-700 px-3 py-1 rounded-full">${breed.age || 'N/A Age'}</span>
                            <span class="text-xs font-medium bg-blue-100 text-blue-700 px-3 py-1 rounded-full">${breed.gender || 'N/A Gender'}</span>
                            <span class="text-xs font-medium bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full">${breed.purity || 'N/A Purity'}</span>
                        </div>
                        
                        <div class="flex justify-between items-center mt-4 border-t pt-3">
                            <span class="text-2xl font-extrabold text-green-600">
                                KES ${breed.price.toLocaleString()}
                            </span>
                            <span class="text-sm font-medium ${breed.isNegotiable ? 'text-blue-500 bg-blue-100' : 'text-red-500 bg-red-100'} px-3 py-1 rounded-full">
                                ${breed.isNegotiable ? 'Negotiable' : 'Fixed Price'}
                            </span>
                        </div>
                        <button onclick="window.navigate('details/${breed.id}')" class="mt-4 w-full bg-orange-500 hover:bg-orange-600 text-white py-2 rounded-lg font-semibold transition duration-200">View Details</button>
                    </div>
                </div>
            `).join('');
        }

        // --- RENDER BREED DETAILS PAGE (Req 4: New full page view) ---
        window.renderBreedDetailsPage = function(id) {
            const breed = window.breeds.find(b => b.id === id);
            if (!breed) {
                return `
                    <div class="text-center p-10 bg-white rounded-xl shadow-xl">
                        <h2 class="text-3xl text-red-500 font-bold mb-4">Breed Not Found</h2>
                        <p class="text-gray-600 mb-6">The dog breed you are looking for does not exist or was removed.</p>
                        <button onclick="window.navigate('breeds')" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-full transition duration-200">
                            <i data-lucide="arrow-left" class="w-5 h-5 inline mr-2"></i> Back to Breeds
                        </button>
                    </div>
                `;
            }

            // WhatsApp link construction
            const phoneNumber = '254713844025';
            const waText = encodeURIComponent(`Hello, I'm interested in the ${breed.breed} (ID: ${breed.id.toUpperCase()}) listed for KES ${breed.price.toLocaleString()}.`);
            const waLink = `https://wa.me/${phoneNumber}?text=${waText}`;
            
            return `
                <div class="bg-white p-6 md:p-10 rounded-2xl shadow-2xl relative">
                    <button onclick="window.navigate('breeds')" class="absolute top-4 left-4 bg-gray-200 hover:bg-gray-300 p-2 rounded-full text-gray-700 transition duration-200 z-10 hidden sm:block">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                    <h2 class="text-4xl font-extrabold text-center mb-6 pt-4" style="color: var(--secondary-color);">${breed.breed}</h2>

                    <div class="md:grid md:grid-cols-5 md:gap-8">
                        <div class="md:col-span-3">
                            <img id="detail-main-image" src="${breed.images[0]}" onerror="this.onerror=null;this.src='https://placehold.co/800x600/A34A00/FFF?text=Image+Missing';" alt="${breed.breed}" class="w-full h-80 object-cover rounded-xl shadow-xl mb-4 transition-opacity duration-300">

                            <div class="grid grid-cols-4 sm:grid-cols-5 gap-2 max-h-40 overflow-x-auto p-1">
                                ${breed.images.map((img, index) => `
                                    <img src="${img}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/A34A00/FFF?text=${index+1}';" 
                                        onclick="document.getElementById('detail-main-image').src='${img}'" 
                                        class="w-full h-16 object-cover rounded-lg shadow-md border-2 border-transparent hover:border-orange-500 transition cursor-pointer">
                                `).join('')}
                            </div>
                        </div>

                        <div class="md:col-span-2 mt-8 md:mt-0">
                            <div class="p-4 bg-orange-50 rounded-xl mb-6 shadow-inner">
                                <p class="text-4xl font-extrabold text-green-600 mb-2">KES ${breed.price.toLocaleString()}</p>
                                <p class="text-lg font-medium ${breed.isNegotiable ? 'text-blue-600' : 'text-red-600'}">
                                    Price Status: <span class="font-bold">${breed.isNegotiable ? 'Negotiable' : 'Fixed'}</span>
                                </p>
                            </div>

                            <h3 class="text-2xl font-bold mb-3" style="color: var(--primary-color);">Key Characteristics</h3>
                            <p class="text-gray-700 mb-6 leading-relaxed">${breed.description}</p>
                            
                            <div class="space-y-3 mb-6">
                                <p class="flex items-center text-lg text-gray-800"><i data-lucide="calendar" class="w-5 h-5 mr-3 text-orange-500"></i> **Age:** ${breed.age || 'N/A'}</p>
                                <p class="flex items-center text-lg text-gray-800"><i data-lucide="user" class="w-5 h-5 mr-3 text-orange-500"></i> **Gender:** ${breed.gender || 'N/A'}</p>
                                <p class="flex items-center text-lg text-gray-800"><i data-lucide="award" class="w-5 h-5 mr-3 text-orange-500"></i> **Purity:** ${breed.purity || 'N/A'}</p>
                                <p class="flex items-center text-lg text-gray-800"><i data-lucide="tag" class="w-5 h-5 mr-3 text-orange-500"></i> **ID:** ${breed.id.toUpperCase()}</p>
                                <p class="flex items-center text-lg text-gray-800"><i data-lucide="search" class="w-5 h-5 mr-3 text-orange-500"></i> **SEO Focus:** ${breed.seoKeywords.split(',')[0].trim()}</p>
                            </div>

                            <a href="${waLink}" target="_blank" class="mt-8 w-full block bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl shadow-lg transition duration-300 transform hover:scale-[1.01] flex items-center justify-center">
                                <i data-feather="whatsapp" class="w-6 h-6 mr-3"></i>
                                Buy Now via WhatsApp
                            </a>

                            <button onclick="window.navigate('breeds')" class="mt-4 w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 rounded-xl transition duration-200 block sm:hidden">
                                <i data-lucide="paw-print" class="w-5 h-5 inline mr-2"></i> Browse Other Breeds
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };


        // --- ADMIN AUTH & RENDER ---
        function renderAdminAuth() {
            return `
                <div class="max-w-md mx-auto p-8 bg-white rounded-xl shadow-2xl mt-10">
                    <h2 class="text-3xl font-bold mb-6 text-center" style="color: var(--secondary-color);">Admin Access</h2>
                    <p class="text-center text-gray-500 mb-6">Enter the secret password to manage site content.</p>
                    <input type="password" id="admin-password" placeholder="Enter Admin Password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 mb-4">
                    <button onclick="window.authenticateAdmin()" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-lg transition duration-200">
                        Login
                    </button>
                    <p class="mt-4 text-center text-sm text-gray-400">Your User ID: <span class="font-mono text-xs">${window.userId || 'Loading...'}</span></p>
                </div>
            `;
        }

        window.authenticateAdmin = function authenticateAdmin() {
            const password = document.getElementById('admin-password').value;
            // Password Check (Hardcoded for simplicity in this environment)
            if (password === 'Classdogs2022' || password === 'admin') {
                window.isAdminAuthenticated = true;
                window.showModal('Success', 'Admin access granted!', 'success');
                renderAdminPanel();
            } else {
                window.showModal('Error', 'Incorrect password.', 'error');
            }
        }
        
        function renderAdminPanel() {
            if (!window.isAdminAuthenticated) {
                return window.navigate('admin');
            }

            document.getElementById('main-content').innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl p-4 sm:p-8">
                    <h2 class="text-3xl font-bold mb-6 border-b pb-3" style="color: var(--secondary-color);">Website Administration Panel</h2>

                    <div class="md:flex md:space-x-6">
                        <div class="md:w-1/4 mb-6 md:mb-0">
                            <nav class="flex flex-wrap md:flex-col space-y-2 md:space-y-4">
                                <button onclick="window.switchAdminTab('content')" class="admin-tab-btn bg-orange-500 text-white py-2 px-4 rounded-lg font-semibold flex items-center transition duration-200" data-tab="content">
                                    <i data-lucide="layout-list" class="w-5 h-5 mr-2"></i> Content Management
                                </button>
                                <button onclick="window.switchAdminTab('price')" class="admin-tab-btn text-gray-700 hover:bg-gray-100 py-2 px-4 rounded-lg font-semibold flex items-center transition duration-200" data-tab="price">
                                    <i data-lucide="indian-rupee" class="w-5 h-5 mr-2"></i> Price & Detail Editor
                                </button>
                                <button onclick="window.switchAdminTab('settings')" class="admin-tab-btn text-gray-700 hover:bg-gray-100 py-2 px-4 rounded-lg font-semibold flex items-center transition duration-200" data-tab="settings">
                                    <i data-lucide="palette" class="w-5 h-5 mr-2"></i> Site Settings (Fonts/SEO)
                                </button>
                                <button onclick="window.switchAdminTab('performance')" class="admin-tab-btn text-gray-700 hover:bg-gray-100 py-2 px-4 rounded-lg font-semibold flex items-center transition duration-200" data-tab="performance">
                                    <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i> Performance Stats
                                </button>
                                <button onclick="window.switchAdminTab('bug')" class="admin-tab-btn text-gray-700 hover:bg-gray-100 py-2 px-4 rounded-lg font-semibold flex items-center transition duration-200" data-tab="bug">
                                    <i data-lucide="bug" class="w-5 h-5 mr-2"></i> Bug Report
                                </button>
                                <button onclick="window.isAdminAuthenticated=false; window.navigate('home');" class="mt-8 text-red-500 hover:text-red-700 py-2 px-4 rounded-lg font-semibold flex items-center transition duration-200">
                                    <i data-lucide="log-out" class="w-5 h-5 mr-2"></i> Logout
                                </button>
                            </nav>
                        </div>

                        <div id="admin-content-area" class="md:w-3/4 bg-gray-50 p-6 rounded-xl shadow-inner">
                            </div>
                    </div>
                </div>
            `;
            window.switchAdminTab('content');
            lucide.createIcons();
        }

        window.switchAdminTab = function switchAdminTab(tabName) {
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('bg-orange-500', 'text-white');
                btn.classList.add('text-gray-700', 'hover:bg-gray-100');
            });
            document.querySelector(`.admin-tab-btn[data-tab="${tabName}"]`).classList.remove('text-gray-700', 'hover:bg-gray-100');
            document.querySelector(`.admin-tab-btn[data-tab="${tabName}"]`).classList.add('bg-orange-500', 'text-white');

            const contentArea = document.getElementById('admin-content-area');
            contentArea.innerHTML = '';

            switch (tabName) {
                case 'content':
                    contentArea.innerHTML = renderContentTab();
                    // Populate the dropdown with all breeds
                    const breedSelect = document.getElementById('new-breed-name');
                    if (breedSelect) {
                        ALL_DOG_BREEDS.forEach(breed => {
                            const option = document.createElement('option');
                            option.value = breed;
                            option.textContent = breed;
                            breedSelect.appendChild(option);
                        });
                    }
                    renderBreedListInAdmin();
                    break;
                case 'price':
                    // Renamed functions used here
                    contentArea.innerHTML = renderBreedDetailEditor();
                    renderBreedDetailEditorList();
                    break;
                case 'settings':
                    contentArea.innerHTML = renderSettingsTab();
                    // Manually populate vet slide list when settings are rendered
                    document.getElementById('vet-slide-list').innerHTML = renderVetSlidesList();
                    break;
                case 'performance':
                    contentArea.innerHTML = renderPerformanceTab();
                    break;
                case 'bug':
                    contentArea.innerHTML = renderBugReportTab();
                    break;
            }
            lucide.createIcons();
        }

        // --- ADMIN BREED CONTENT MANAGEMENT (Req 1: Improved Image Handling & User Request 1, 2, 3) ---
        
        function renderContentTab() {
            return `
                <h3 class="text-2xl font-bold mb-4">Dog Breed Management</h3>
                <p class="text-sm text-gray-500 mb-6">Create new breeds or edit existing ones.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h4 class="font-semibold text-lg mb-3">Existing Breeds</h4>
                        <div id="admin-breed-list" class="space-y-2 max-h-96 overflow-y-auto">
                            <p class="text-gray-400">Loading breeds...</p>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h4 class="font-semibold text-lg mb-3">Add New Dog Breed</h4>
                        <form onsubmit="window.handleNewBreed(event)">
                            <label class="block mb-2 font-medium">Breed Name</label>
                            <select id="new-breed-name" required class="w-full p-2 border rounded-lg mb-3">
                                <option value="">-- Select Breed --</option>
                                </select>

                            <div class="grid grid-cols-3 gap-3 mb-3">
                                <div>
                                    <label class="block mb-2 font-medium text-sm">Age (e.g., 10 weeks)</label>
                                    <input type="text" id="new-breed-age" required class="w-full p-2 border rounded-lg" placeholder="12 weeks">
                                </div>
                                <div>
                                    <label class="block mb-2 font-medium text-sm">Gender</label>
                                    <select id="new-breed-gender" required class="w-full p-2 border rounded-lg">
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-2 font-medium text-sm">Purity Status</label>
                                    <select id="new-breed-purity" required class="w-full p-2 border rounded-lg">
                                        <option value="Purebred">Purebred</option>
                                        <option value="Mix/Hybrid">Mix/Hybrid</option>
                                    </select>
                                </div>
                            </div>
                            
                            <label class="block mb-2 font-medium">Description</label>
                            <textarea id="new-breed-desc" required class="w-full p-2 border rounded-lg mb-3 h-24"></textarea>
                            <label class="block mb-2 font-medium">Initial Image URLs (Min 4 required)</label>
                            <input type="url" id="new-breed-img-1" required class="w-full p-2 border rounded-lg mb-3" value="https://placehold.co/600x400/94A3B8/FFF?text=New+Breed+Image+1">
                            <input type="url" id="new-breed-img-2" required class="w-full p-2 border rounded-lg mb-3" value="https://placehold.co/600x400/94A3B8/FFF?text=New+Breed+Image+2">
                            <input type="url" id="new-breed-img-3" required class="w-full p-2 border rounded-lg mb-3" value="https://placehold.co/600x400/94A3B8/FFF?text=New+Breed+Image+3">
                            <input type="url" id="new-breed-img-4" required class="w-full p-2 border rounded-lg mb-3" value="https://placehold.co/600x400/94A3B8/FFF?text=New+Breed+Image+4">
                            <label class="block mb-2 font-medium">SEO Keywords</label>
                            <input type="text" id="new-breed-keywords" required class="w-full p-2 border rounded-lg mb-3" placeholder="e.g., Terrier Kenya, Puppies Kisumu">
                            <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded-lg transition duration-200">
                                Add Breed
                            </button>
                        </form>
                    </div>
                </div>
                <div id="image-management-modal-content" class="hidden"></div>
            `;
        }
        
        window.renderBreedListInAdmin = function renderBreedListInAdmin() {
            const listDiv = document.getElementById('admin-breed-list');
            if (!listDiv || !window.breeds) return;

            if (window.breeds.length === 0) {
                listDiv.innerHTML = '<p class="text-gray-500">No breeds found. Add one using the form!</p>';
                return;
            }

            listDiv.innerHTML = window.breeds.map(breed => `
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg border">
                    <span class="font-medium">${breed.breed}</span>
                    <div class="flex space-x-2">
                        <button onclick="window.editBreedContent('${breed.id}')" class="text-blue-500 hover:text-blue-700 p-1 rounded-full bg-blue-100 transition">
                            <i data-lucide="image" class="w-5 h-5"></i>
                        </button>
                        <button onclick="window.deleteBreed('${breed.id}', '${breed.breed}')" class="text-red-500 hover:text-red-700 p-1 rounded-full bg-red-100 transition">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        window.handleNewBreed = async function handleNewBreed(event) {
            event.preventDefault();
            const breedName = document.getElementById('new-breed-name').value.trim();
            const description = document.getElementById('new-breed-desc').value.trim();
            const keywords = document.getElementById('new-breed-keywords').value.trim();
            // NEW FIELDS
            const age = document.getElementById('new-breed-age').value.trim();
            const gender = document.getElementById('new-breed-gender').value.trim();
            const purity = document.getElementById('new-breed-purity').value.trim();

            const images = [
                document.getElementById('new-breed-img-1').value.trim(),
                document.getElementById('new-breed-img-2').value.trim(),
                document.getElementById('new-breed-img-3').value.trim(),
                document.getElementById('new-breed-img-4').value.trim(),
            ].filter(url => url.length > 0);

            if (!breedName || !description || images.length < 4 || !age || !gender || !purity) {
                return window.showModal('Input Error', 'Please fill in all breed, detail, and image fields.', 'error');
            }

            const newId = breedName.toLowerCase().replace(/\s/g, '-').replace(/[^a-z0-9-]/g, '');
            const docRef = window.doc(window.db, BREED_COLLECTION, newId);

            try {
                await window.runTransaction(window.db, async (transaction) => {
                    const docSnapshot = await transaction.get(docRef);
                    if (docSnapshot.exists()) {
                        throw new Error("Breed already exists. Please edit the existing one.");
                    }
                    const newBreedData = {
                        id: newId,
                        breed: breedName,
                        description: description,
                        price: 0,
                        isNegotiable: true,
                        images: images,
                        seoKeywords: keywords,
                        age: age,     // NEW
                        gender: gender, // NEW
                        purity: purity  // NEW
                    };
                    transaction.set(docRef, newBreedData);
                });
                window.showModal('Success', `${breedName} added! You can now manage its price and details.`, 'success');
                event.target.reset(); // Clear form
                // FIX: Manually refresh the list in Admin panel for immediate visual update
                renderBreedListInAdmin(); 
            } catch (error) {
                console.error("Error adding breed:", error);
                window.showModal('Error', `Failed to add breed: ${error.message || 'Unknown error.'}`, 'error');
            }
        }


        window.editBreedContent = function editBreedContent(id) {
            const breed = window.breeds.find(b => b.id === id);
            if (!breed) return window.showModal('Error', 'Breed not found.');

            const contentHTML = `
                <h4 class="text-xl font-bold mb-4">${breed.breed} - Content Editor</h4>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">Description</label>
                    <textarea id="edit-desc-${id}" class="w-full p-2 border rounded-lg h-20">${breed.description}</textarea>
                    <label class="block mb-2 font-medium mt-3">SEO Keywords</label>
                    <input type="text" id="edit-keywords-${id}" class="w-full p-2 border rounded-lg" value="${breed.seoKeywords}">
                </div>

                <div class="bg-gray-100 p-4 rounded-lg mb-4">
                    <h5 class="font-semibold mb-2 flex items-center justify-between">
                        Image Gallery (Min 4, Max 10)
                        <span class="text-sm text-gray-500">${breed.images.length}/10 images</span>
                    </h5>
                    
                    <div id="image-list-${id}" class="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-64 overflow-y-auto p-2 border rounded-lg bg-white">
                        ${breed.images.map((img, index) => `
                            <div class="relative group">
                                <img src="${img}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/A34A00/FFF?text=Img${index+1}';" class="w-full h-20 object-cover rounded-md">
                                
                                <button onclick="window.removeImage('${id}', '${img}')" class="absolute top-1 right-1 bg-red-600 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition duration-200">
                                    <i data-lucide="x" class="w-3 h-3"></i>
                                </button>
                                
                                <input type="url" value="${img}" placeholder="Image URL" class="w-full text-xs p-1 mt-1 border rounded image-input" data-index="${index}">
                            </div>
                        `).join('')}
                    </div>

                    <h5 class="font-semibold mt-4 mb-2">Add New Image</h5>
                    <input type="url" id="new-image-url-${id}" placeholder="Paste new non-copyright image URL" class="w-full p-2 border rounded-lg mb-2">
                    
                    <div class="flex space-x-2">
                        <button onclick="window.addImage('${id}')" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 rounded-lg transition duration-200">
                            Add URL
                        </button>
                        <button onclick="window.simulateFileUpload('${id}')" class="w-1/2 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 rounded-lg transition duration-200 flex items-center justify-center">
                            <i data-lucide="upload" class="w-4 h-4 mr-2"></i>
                            Simulate Gallery Upload
                        </button>
                    </div>
                </div>

                <div class="flex justify-end space-x-3">
                    <button onclick="window.updateBreedContent('${id}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-200">Save Changes</button>
                </div>
            `;
            lucide.createIcons(); 
            window.showModal(`Edit ${breed.breed}`, contentHTML, 'info', []);
        }

        window.simulateFileUpload = function simulateFileUpload(id) {
            const breed = window.breeds.find(b => b.id === id);
            if (!breed) return;
            if (breed.images.length >= 10) return window.showModal('Limit Reached', 'A maximum of 10 images are allowed for one breed.', 'error');

            const timestamp = Date.now();
            const newUrl = `https://placehold.co/600x400/38B2AC/FFF?text=Gallery+Upload+${timestamp}`;
            
            window.addImage(id, newUrl);
            window.showModal('Simulated Upload', 'A placeholder image has been added, simulating a successful gallery/file upload.', 'info');
        }

        window.addImage = async function addImage(id, url = null) {
            const breed = window.breeds.find(b => b.id === id);
            if (!breed) return;

            const newUrl = url || document.getElementById(`new-image-url-${id}`).value.trim();

            if (!newUrl) return window.showModal('Input Error', 'Please provide an image URL.');
            if (breed.images.length >= 10) return window.showModal('Limit Reached', 'A maximum of 10 images are allowed for one breed.', 'error');
            if (breed.images.includes(newUrl)) return window.showModal('Duplicate', 'This image URL is already in the list.', 'info');

            const docRef = window.doc(window.db, BREED_COLLECTION, id);
            try {
                await window.updateDoc(docRef, {
                    images: window.arrayUnion(newUrl)
                });
                if (document.getElementById(`new-image-url-${id}`)) {
                    document.getElementById(`new-image-url-${id}`).value = '';
                }
                // The onSnapshot listener will re-render the breed data, but we re-render the modal for immediate feedback
                window.editBreedContent(id);
            } catch (e) {
                console.error("Error adding image:", e);
                window.showModal('Error', 'Failed to add image. See console.', 'error');
            }
        }

        window.removeImage = async function removeImage(id, url) {
            const breed = window.breeds.find(b => b.id === id);
            if (!breed) return;
            if (breed.images.length <= 4) return window.showModal('Image Limit', 'A minimum of 4 images must be kept for the breed.', 'error');

            const docRef = window.doc(window.db, BREED_COLLECTION, id);
            try {
                await window.updateDoc(docRef, {
                    images: window.arrayRemove(url)
                });
                window.editBreedContent(id); // Re-render modal to reflect changes
            } catch (e) {
                console.error("Error removing image:", e);
                window.showModal('Error', 'Failed to remove image. See console.', 'error');
            }
        }

        window.updateBreedContent = async function updateBreedContent(id) {
            const breed = window.breeds.find(b => b.id === id);
            if (!breed) return;

            const newDesc = document.getElementById(`edit-desc-${id}`).value.trim();
            const newKeywords = document.getElementById(`edit-keywords-${id}`).value.trim();
            const imageInputs = document.querySelectorAll(`#image-list-${id} .image-input`);

            const updatedImages = Array.from(imageInputs).map(input => input.value.trim()).filter(url => url.length > 0);

            if (updatedImages.length < 4 || updatedImages.length > 10) {
                 return window.showModal('Validation Error', 'The number of images must be between 4 and 10.', 'error');
            }

            const docRef = window.doc(window.db, BREED_COLLECTION, id);
            try {
                await window.updateDoc(docRef, {
                    description: newDesc,
                    seoKeywords: newKeywords,
                    images: updatedImages
                });
                window.closeModal();
                window.showModal('Success', `${breed.breed} content updated successfully!`, 'success');
            } catch (e) {
                console.error("Error updating breed content:", e);
                window.showModal('Error', 'Failed to update breed content. See console.', 'error');
            }
        }

        window.deleteBreed = function deleteBreed(id, breedName) {
             window.showModal('Confirm Deletion', `Are you sure you want to permanently delete the listing for **${breedName}**? This cannot be undone.`, 'error', [
                {
                    text: 'Confirm Delete',
                    class: 'px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-200',
                    handler: async () => {
                        const docRef = window.doc(window.db, BREED_COLLECTION, id);
                        try {
                            await window.deleteDoc(docRef);
                            window.closeModal();
                            window.showModal('Deleted', `${breedName} listing has been removed.`, 'success');
                        } catch (e) {
                            console.error("Error deleting breed:", e);
                            window.showModal('Error', 'Failed to delete breed. See console.', 'error');
                        }
                    }
                }
            ]);
        }


        // --- ADMIN DETAIL EDITOR TAB (Updated to manage Price, Age, Gender, Purity) ---

        // Renamed from renderPriceListEditor
        function renderBreedDetailEditor() {
            return `
                <h3 class="text-2xl font-bold mb-4">Price & Detail Editor (Admin Only)</h3>
                <p class="text-sm text-gray-500 mb-6">Set the **price, negotiability, age, gender, and purity** for each dog breed listing.</p>
                <div id="detail-editor-list" class="space-y-4 max-h-[70vh] overflow-y-auto">
                    <p class="text-gray-400">Loading breeds...</p>
                </div>
            `;
        }

        // Renamed from renderPriceEditorBreedList
        window.renderBreedDetailEditorList = function renderBreedDetailEditorList() {
            const listDiv = document.getElementById('detail-editor-list');
            if (!listDiv || !window.breeds.length) return;

            listDiv.innerHTML = window.breeds.map(breed => `
                <div class="bg-white p-4 rounded-lg shadow-md">
                    <div class="font-bold text-lg mb-3 border-b pb-2">${breed.breed}</div>
                    
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="flex-1">
                            <label class="block mb-1 font-medium text-sm">Price (KES):</label>
                            <input type="number" id="price-input-${breed.id}" value="${breed.price}" min="0" class="w-full p-2 border rounded-lg">
                        </div>
                        <label class="font-medium text-sm cursor-pointer flex items-center mt-4">
                            <input type="checkbox" id="negotiable-checkbox-${breed.id}" ${breed.isNegotiable ? 'checked' : ''} class="w-4 h-4 text-orange-600 rounded mr-2">
                            Negotiable
                        </label>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4">
                        <div>
                            <label class="block mb-1 font-medium text-sm">Age</label>
                            <input type="text" id="age-input-${breed.id}" value="${breed.age || ''}" class="w-full p-2 border rounded-lg" placeholder="e.g., 10 weeks">
                        </div>
                        <div>
                            <label class="block mb-1 font-medium text-sm">Gender</label>
                            <select id="gender-select-${breed.id}" class="w-full p-2 border rounded-lg">
                                <option value="Male" ${breed.gender === 'Male' ? 'selected' : ''}>Male</option>
                                <option value="Female" ${breed.gender === 'Female' ? 'selected' : ''}>Female</option>
                                <option value="N/A" ${!breed.gender ? 'selected' : ''}>N/A</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-1 font-medium text-sm">Purity</label>
                            <select id="purity-select-${breed.id}" class="w-full p-2 border rounded-lg">
                                <option value="Purebred" ${breed.purity === 'Purebred' ? 'selected' : ''}>Purebred</option>
                                <option value="Mix/Hybrid" ${breed.purity === 'Mix/Hybrid' ? 'selected' : ''}>Mix/Hybrid</option>
                                <option value="N/A" ${!breed.purity ? 'selected' : ''}>N/A</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="window.updateBreedDetails('${breed.id}')" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-3 text-sm rounded-lg transition duration-200 mt-2">
                        Save All Details
                    </button>
                </div>
            `).join('');
        }

        // Renamed from updatePrice
        window.updateBreedDetails = async function updateBreedDetails(id) {
            const priceInput = document.getElementById(`price-input-${id}`);
            const negotiableCheckbox = document.getElementById(`negotiable-checkbox-${id}`);
            const ageInput = document.getElementById(`age-input-${id}`);
            const genderSelect = document.getElementById(`gender-select-${id}`);
            const puritySelect = document.getElementById(`purity-select-${id}`);

            const newPrice = parseInt(priceInput.value, 10);
            const newNegotiability = negotiableCheckbox.checked;
            const newAge = ageInput.value.trim();
            const newGender = genderSelect.value;
            const newPurity = puritySelect.value;

            if (isNaN(newPrice) || newPrice < 0) {
                return window.showModal('Input Error', 'Please enter a valid price (non-negative number).', 'error');
            }
            if (!newAge) {
                return window.showModal('Input Error', 'Age field cannot be empty.', 'error');
            }


            const docRef = window.doc(window.db, BREED_COLLECTION, id);
            try {
                await window.updateDoc(docRef, {
                    price: newPrice,
                    isNegotiable: newNegotiability,
                    age: newAge,
                    gender: newGender,
                    purity: newPurity
                });
                window.showModal('Success', 'Breed details updated successfully!', 'success');
            } catch (e) {
                console.error("Error updating breed details:", e);
                window.showModal('Error', 'Failed to update details. See console.', 'error');
            }
        }
        
        // --- SITE SETTINGS TAB (Req 3: Added Vet Slides Editor) ---

        function renderSettingsTab() {
            const currentFontClass = localStorage.getItem('siteFont') || 'font-inter';
            const fontOptionsHtml = FONT_OPTIONS.map(font => `
                <div class="flex items-center p-2 rounded-lg hover:bg-gray-100 cursor-pointer" onclick="window.changeSiteFont('${font.class}')">
                    <input type="radio" name="site-font" value="${font.class}" ${currentFontClass === font.class ? 'checked' : ''} class="mr-3 text-orange-600">
                    <span class="${font.class} text-lg">${font.name}</span>
                </div>
            `).join('');

            return `
                <h3 class="text-2xl font-bold mb-4">Site Settings</h3>
                
                <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                    <h4 class="font-semibold text-xl mb-3 border-b pb-2">Website Font Selector</h4>
                    <p class="text-sm text-gray-500 mb-3">Select a new primary font for the entire website.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        ${fontOptionsHtml}
                    </div>
                </div>

                <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                    <h4 class="font-semibold text-xl mb-3 border-b pb-2">Homepage Veterinary Slideshow Images</h4>
                    <p class="text-sm text-gray-500 mb-3">Manage the images and captions for the scrolling slideshow on the home page.</p>
                    <div id="vet-slide-list" class="space-y-3 max-h-64 overflow-y-auto">
                        </div>
                    
                    <h5 class="font-semibold mt-4 mb-2">Add New Slide</h5>
                    <input type="url" id="new-vet-url" placeholder="New Image URL" class="w-full p-2 border rounded-lg mb-2">
                    <input type="text" id="new-vet-alt" placeholder="Description/Caption" class="w-full p-2 border rounded-lg mb-2">
                    <button onclick="window.addVetSlide()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 rounded-lg transition duration-200">
                        Add Slide
                    </button>
                </div>

                <div class="bg-white p-4 rounded-lg shadow-md">
                    <h4 class="font-semibold text-xl mb-3 border-b pb-2">Global SEO Keywords</h4>
                    <p class="text-sm text-gray-500 mb-3">These keywords are applied to the website's meta tags.</p>
                    <textarea id="global-seo-keywords" class="w-full p-2 border rounded-lg h-24" placeholder="Enter comma-separated keywords... (e.g., golden retrievers in kenya, pets in kenya, puppies for sale in nairobi)">${document.querySelector('meta[name="keywords"]').content}</textarea>
                    <button onclick="window.updateGlobalSEO()" class="mt-3 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                        Update Global SEO
                    </button>
                </div>
            `;
        }

        function renderVetSlidesList() {
            if (window.vetSlides.length === 0) return '<p class="text-gray-500 p-2">No slides found. Add one above!</p>';
            
            return window.vetSlides.map(slide => `
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 p-2 border rounded-lg bg-gray-50 items-center" data-id="${slide.id}">
                    <img src="${slide.url}" onerror="this.onerror=null;this.src='https://placehold.co/100x50/38B2AC/FFF?text=Slide';" class="w-16 h-8 object-cover rounded">
                    <input type="text" id="vet-alt-${slide.id}" value="${slide.alt}" placeholder="Description" class="flex-grow p-1 border rounded text-sm">
                    <input type="url" id="vet-url-${slide.id}" value="${slide.url}" placeholder="Image URL" class="flex-grow p-1 border rounded text-sm">
                    <button onclick="window.updateVetSlide('${slide.id}')" class="bg-green-500 text-white p-2 rounded-lg text-xs hover:bg-green-600">Save</button>
                    <button onclick="window.deleteVetSlide('${slide.id}')" class="bg-red-500 text-white p-2 rounded-lg text-xs hover:bg-red-600">Remove</button>
                </div>
            `).join('');
        }

        window.addVetSlide = async function addVetSlide() {
            const url = document.getElementById('new-vet-url').value.trim();
            const alt = document.getElementById('new-vet-alt').value.trim();

            if (!url || !alt) return window.showModal('Input Error', 'Please provide both an image URL and a description.', 'error');
            
            try {
                await window.addDoc(window.collection(window.db, VET_SLIDES_COLLECTION), {
                    url: url,
                    alt: alt,
                    timestamp: window.serverTimestamp()
                });
                document.getElementById('new-vet-url').value = '';
                document.getElementById('new-vet-alt').value = '';
                window.showModal('Success', 'New slide added to the homepage slideshow.', 'success');
            } catch (e) {
                console.error("Error adding vet slide:", e);
                window.showModal('Error', 'Failed to add slide.', 'error');
            }
        }

        window.updateVetSlide = async function updateVetSlide(id) {
            const newAlt = document.getElementById(`vet-alt-${id}`).value.trim();
            const newUrl = document.getElementById(`vet-url-${id}`).value.trim();
            
            if (!newUrl || !newAlt) return window.showModal('Input Error', 'URL and description cannot be empty.', 'error');

            const docRef = window.doc(window.db, VET_SLIDES_COLLECTION, id);
            try {
                await window.updateDoc(docRef, { url: newUrl, alt: newAlt });
                window.showModal('Success', 'Slide updated.', 'success');
            } catch (e) {
                console.error("Error updating vet slide:", e);
                window.showModal('Error', 'Failed to update slide.', 'error');
            }
        }
        
        window.deleteVetSlide = async function deleteVetSlide(id) {
            window.showModal('Confirm Deletion', `Are you sure you want to delete this veterinary slide?`, 'error', [
                {
                    text: 'Confirm Delete',
                    class: 'px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-200',
                    handler: async () => {
                        try {
                            await window.deleteDoc(window.doc(window.db, VET_SLIDES_COLLECTION, id));
                            window.closeModal();
                            window.showModal('Deleted', `Slide removed.`, 'success');
                        } catch (e) {
                            console.error("Error deleting slide:", e);
                            window.showModal('Error', 'Failed to delete slide. See console.', 'error');
                        }
                    }
                }
            ]);
        }


        const FONT_OPTIONS = [
            { name: 'Inter (Default)', class: 'font-inter' },
            { name: 'Playfair Display', class: 'font-playfair' },
            { name: 'Roboto Slab', class: 'font-robotoslab' },
            { name: 'Lato', class: 'font-lato' },
            { name: 'Montserrat', class: 'font-montserrat' },
            { name: 'Open Sans', class: 'font-opensans' },
            { name: 'Merriweather', class: 'font-merriweather' },
            { name: 'Oswald', class: 'font-oswald' },
            { name: 'Poiret One', class: 'font-poiretone' },
            { name: 'Cormorant Garamond', class: 'font-cormorant' }
        ];

        window.changeSiteFont = function changeSiteFont(fontClass) {
            document.body.classList.forEach(className => {
                if (className.startsWith('font-')) {
                    document.body.classList.remove(className);
                }
            });
            document.body.classList.add(fontClass);
            localStorage.setItem('siteFont', fontClass);
        }

        window.updateGlobalSEO = function updateGlobalSEO() {
            const keywords = document.getElementById('global-seo-keywords').value.trim();
            document.querySelector('meta[name="keywords"]').content = keywords;
            window.showModal('SEO Updated', 'Global SEO keywords have been updated in the page metadata.', 'success');
        }

        function renderPerformanceTab() {
            return `
                <h3 class="text-2xl font-bold mb-6">Site Performance Overview</h3>
                <p class="text-sm text-gray-500 mb-6">Visitor statistics collected from the Firestore database.</p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-white p-4 rounded-lg shadow-md text-center">
                        <h4 class="text-lg font-semibold text-gray-500">Today's Visitors</h4>
                        <p id="stat-daily" class="text-4xl font-extrabold text-orange-600 mt-1">0</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-md text-center">
                        <h4 class="text-lg font-semibold text-gray-500">Last 7 Days Total</h4>
                        <p id="stat-weekly" class="text-4xl font-extrabold text-blue-600 mt-1">0</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-md text-center">
                        <h4 class="text-lg font-semibold text-gray-500">Last 30 Days Total</h4>
                        <p id="stat-monthly" class="text-4xl font-extrabold text-green-600 mt-1">0</p>
                    </div>
                </div>

                <h4 class="text-xl font-bold mb-4">Daily Visitor Log</h4>
                <div class="bg-white p-4 rounded-lg shadow-inner max-h-64 overflow-y-auto">
                    <ul id="performance-log" class="space-y-2 text-sm">
                        <li>Loading log...</li>
                    </ul>
                </div>
            `;
        }

        function renderPerformanceStats(stats) {
            const today = new Date();
            const todayStr = today.toISOString().slice(0, 10);
            
            // Calculate date strings for comparison
            const getDateString = (daysAgo) => new Date(today.getTime() - (daysAgo * 24 * 60 * 60 * 1000)).toISOString().slice(0, 10);
            const sevenDaysAgoStr = getDateString(7);
            const thirtyDaysAgoStr = getDateString(30);

            let dailyCount = 0;
            let weeklyCount = 0;
            let monthlyCount = 0;
            let logHtml = '';

            // Ensure stats is an array and sort by date descending
            if (Array.isArray(stats)) {
                stats.sort((a, b) => (b.date || '').localeCompare(a.date || ''));

                stats.forEach(stat => {
                    const date = stat.date;
                    const count = stat.count || 0;

                    logHtml += `<li class="flex justify-between items-center border-b pb-1">
                                    <span class="font-mono text-gray-700">${date}</span>
                                    <span class="font-bold text-lg">${count} Visits</span>
                                </li>`;

                    if (date === todayStr) {
                        dailyCount = count;
                    }

                    // Simple count aggregation for last 7/30 days (excluding today which is handled by dailyCount)
                    if (date >= sevenDaysAgoStr) { 
                        weeklyCount += count;
                    }
                    if (date >= thirtyDaysAgoStr) { 
                        monthlyCount += count;
                    }
                });
            }

            // Ensure elements exist before updating (only runs in admin/performance tab)
            if (window.location.hash === '#admin' && window.isAdminAuthenticated && document.getElementById('stat-daily')) {
                document.getElementById('stat-daily').textContent = dailyCount.toLocaleString();
                document.getElementById('stat-weekly').textContent = weeklyCount.toLocaleString();
                document.getElementById('stat-monthly').textContent = monthlyCount.toLocaleString();
                document.getElementById('performance-log').innerHTML = logHtml || '<li>No visitor data recorded yet.</li>';
            }
        }
        
        function renderBugReportTab() {
            return `
                <h3 class="text-2xl font-bold mb-4">Submit a Bug Report</h3>
                <p class="text-sm text-gray-500 mb-6">Help us improve by reporting any issues you find on the site.</p>
                
                <form onsubmit="window.handleBugReport(event)" class="bg-white p-6 rounded-lg shadow-md">
                    <div class="mb-4">
                        <label class="block mb-2 font-medium">Your Email (Optional)</label>
                        <input type="email" id="bug-email" class="w-full p-2 border rounded-lg">
                    </div>
                    <div class="mb-4">
                        <label class="block mb-2 font-medium">Issue Summary</label>
                        <input type="text" id="bug-summary" required class="w-full p-2 border rounded-lg">
                    </div>
                    <div class="mb-4">
                        <label class="block mb-2 font-medium">Detailed Description of the Bug</label>
                        <textarea id="bug-description" required class="w-full p-2 border rounded-lg h-32"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg transition duration-200">
                        Submit Report
                    </button>
                </form>
            `;
        }

        window.handleBugReport = async function handleBugReport(event) {
            event.preventDefault();
            const email = document.getElementById('bug-email').value.trim();
            const summary = document.getElementById('bug-summary').value.trim();
            const description = document.getElementById('bug-description').value.trim();

            const reportsCollection = `artifacts/${appId}/admin/reports`;
            try {
                await window.addDoc(window.collection(window.db, reportsCollection), {
                    summary: summary,
                    description: description,
                    email: email || 'N/A',
                    reportedBy: window.userId,
                    timestamp: window.serverTimestamp()
                });
                window.showModal('Report Sent!', 'Thank you! Your bug report has been successfully submitted.', 'success');
                document.getElementById('bug-email').value = '';
                document.getElementById('bug-summary').value = '';
                document.getElementById('bug-description').value = '';
            } catch (e) {
                console.error("Error submitting bug report:", e);
                window.showModal('Error', 'Failed to submit report. Please try again later.', 'error');
            }
        }

        window.onload = () => {
            const savedFont = localStorage.getItem('siteFont');
            if (savedFont) {
                document.body.classList.add(savedFont);
            }
            window.initializeAppAndAuth();
        };

    </script>
</body>
</html>
